/*
	Masked Input plugin for jQuery
	Copyright (c) 2007-2011 Josh Bush (digitalbush.com)
	Licensed under the MIT license (http://digitalbush.com/projects/masked-input-plugin/#license) 
	Version: 1.3
*/
!function($){var pasteEventName=($("body").is(".ie *")?"paste":"input")+".mask",iPhone=window.orientation!=undefined;$.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]",b:"[A-Z0-9]"},dataName:"rawMaskFn"},$.fn.extend({caret:function(begin,end){if(0!=this.length){if("number"==typeof begin)return end="number"==typeof end?end:begin,this.each(function(){if(this.setSelectionRange)this.setSelectionRange(begin,end);else if(this.createTextRange){var range=this.createTextRange();range.collapse(!0),range.moveEnd("character",end),range.moveStart("character",begin),range.select()}});if(this[0].setSelectionRange)begin=this[0].selectionStart,end=this[0].selectionEnd;else if(document.selection&&document.selection.createRange){var range=document.selection.createRange();begin=0-range.duplicate().moveStart("character",-1e5),end=begin+range.text.length}return{begin:begin,end:end}}},unmask:function(){return this.trigger("unmask")},mask:function(mask,settings){if(!mask&&this.length>0)return $(this[0]).data($.mask.dataName)();settings=$.extend({placeholder:"_",completed:null},settings);var defs=$.mask.definitions,tests=[],partialPosition=mask.length,firstNonMaskPos=null,len=mask.length;return $.each(mask.split(""),function(i,c){"?"==c?(len--,partialPosition=i):defs[c]?(tests.push(new RegExp(defs[c])),null==firstNonMaskPos&&(firstNonMaskPos=tests.length-1)):tests.push(null)}),this.trigger("unmask").each(function(){function seekNext(pos){for(;++pos<=len&&!tests[pos];);return pos}function seekPrev(pos){for(;--pos>=0&&!tests[pos];);return pos}function shiftL(begin,end){if(!(begin<0)){for(var i=begin,j=seekNext(end);i<len;i++)if(tests[i]){if(!(j<len&&tests[i].test(buffer[j])))break;buffer[i]=buffer[j],buffer[j]=settings.placeholder,j=seekNext(j)}writeBuffer(),input.caret(Math.max(firstNonMaskPos,begin))}}function shiftR(pos){for(var i=pos,c=settings.placeholder;i<len;i++)if(tests[i]){var j=seekNext(i),t=buffer[i];if(buffer[i]=c,!(j<len&&tests[j].test(t)))break;c=t}}function keydownEvent(e){var k=e.which;if(8==k||46==k||iPhone&&127==k){var pos=input.caret(),begin=pos.begin,end=pos.end;return end-begin==0&&(begin=46!=k?seekPrev(begin):end=seekNext(begin-1),end=46==k?seekNext(end):end),clearBuffer(begin,end),shiftL(begin,end-1),!1}if(27==k)return input.val(focusText),input.caret(0,checkVal()),!1}function keypressEvent(e){var k=e.which,pos=input.caret();if(e.ctrlKey||e.altKey||e.metaKey||k<32)return!0;if(k){pos.end-pos.begin!=0&&(clearBuffer(pos.begin,pos.end),shiftL(pos.begin,pos.end-1));var p=seekNext(pos.begin-1);if(p<len){var c=String.fromCharCode(k);if(input.attr("upcase")&&"true"==input.attr("upcase").toLowerCase()&&(c=c.toUpperCase()),tests[p].test(c)){shiftR(p),buffer[p]=c,writeBuffer();var next=seekNext(p);input.caret(next),settings.completed&&next>=len&&settings.completed.call(input)}}return!1}}function clearBuffer(start,end){for(var i=start;i<end&&i<len;i++)tests[i]&&(buffer[i]=settings.placeholder)}function writeBuffer(){return input.val(buffer.join("")).val()}function checkVal(allow){for(var test=input.val(),lastMatch=-1,i=0,pos=0;i<len;i++)if(tests[i]){for(buffer[i]=settings.placeholder;pos++<test.length;){var c=test.charAt(pos-1);if(tests[i].test(c)){buffer[i]=c,lastMatch=i;break}}if(pos>test.length)break}else buffer[i]==test.charAt(pos)&&i!=partialPosition&&(pos++,lastMatch=i);return!allow&&lastMatch+1<partialPosition?(input.val(""),clearBuffer(0,len)):(allow||lastMatch+1>=partialPosition)&&(writeBuffer(),allow||input.val(input.val().substring(0,lastMatch+1))),partialPosition?i:firstNonMaskPos}var input=$(this),buffer=$.map(mask.split(""),function(c){if("?"!=c)return defs[c]?settings.placeholder:c}),focusText=input.val();input.data($.mask.dataName,function(){return $.map(buffer,function(c,i){return tests[i]&&c!=settings.placeholder?c:null}).join("")}),input.attr("readonly")||input.one("unmask",function(){input.unbind(".mask").removeData($.mask.dataName)}).bind("focus.mask",function(){focusText=input.val();var pos=checkVal();writeBuffer();var moveCaret=function(){pos==mask.length?input.caret(0,pos):input.caret(pos)};($("body").is(".ie *")?moveCaret:function(){setTimeout(moveCaret,0)})()}).bind("blur.mask",function(){checkVal()}).bind("keydown.mask",keydownEvent).bind("keypress.mask",keypressEvent).bind(pasteEventName,function(){setTimeout(function(){input.caret(checkVal(!0))},0)}),checkVal()})}})}(jQuery);