/*!
* validator.js
* Guillaume Potier - <guillaume@wisembly.com>
* Version 1.2.2 - built Tue Jul 21 2015 09:47:45
* MIT Licensed
*
*/
!function(){var exports={},Validator=function(options){this.__class__="Validator",this.__version__="1.2.2",this.options=options||{},this.bindingKey=this.options.bindingKey||"_validatorjsConstraint"};Validator.prototype={constructor:Validator,validate:function(objectOrString,AssertsOrConstraintOrGroup,group){if("string"!=typeof objectOrString&&"object"!=typeof objectOrString)throw new Error("You must validate an object or a string");return"string"==typeof objectOrString||_isArray(objectOrString)?this._validateString(objectOrString,AssertsOrConstraintOrGroup,group):this.isBinded(objectOrString)?this._validateBindedObject(objectOrString,AssertsOrConstraintOrGroup):this._validateObject(objectOrString,AssertsOrConstraintOrGroup,group)},bind:function(object,constraint){if("object"!=typeof object)throw new Error("Must bind a Constraint to an object");return object[this.bindingKey]=new Constraint(constraint),this},unbind:function(object){return"undefined"==typeof object._validatorjsConstraint?this:(delete object[this.bindingKey],this)},isBinded:function(object){return"undefined"!=typeof object[this.bindingKey]},getBinded:function(object){return this.isBinded(object)?object[this.bindingKey]:null},_validateString:function(string,assert,group){var result,failures=[];_isArray(assert)||(assert=[assert]);for(var i=0;i<assert.length;i++){if(!(assert[i]instanceof Assert))throw new Error("You must give an Assert or an Asserts array to validate a string");!0!==(result=assert[i].check(string,group))&&failures.push(result)}return!failures.length||failures},_validateObject:function(object,constraint,group){if("object"!=typeof constraint)throw new Error("You must give a constraint to validate an object");return constraint instanceof Assert?constraint.check(object,group):constraint instanceof Constraint?constraint.check(object,group):new Constraint(constraint).check(object,group)},_validateBindedObject:function(object,group){return object[this.bindingKey].check(object,group)}},Validator.errorCode={must_be_a_string:"must_be_a_string",must_be_an_array:"must_be_an_array",must_be_a_number:"must_be_a_number",must_be_a_string_or_array:"must_be_a_string_or_array"};var Constraint=function(data,options){if(this.__class__="Constraint",this.options=options||{},this.nodes={},data)try{this._bootstrap(data)}catch(err){throw new Error("Should give a valid mapping object to Constraint",err,data)}};Constraint.prototype={constructor:Constraint,isRequired:function(property,group,deepRequired){for(var constraint=this.get(property),constraints=_isArray(constraint)?constraint:[constraint],i=constraints.length-1;i>=0;i--){if("Required"===(constraint=constraints[i]).__class__&&constraints[i].requiresValidation(group))return!0;if(deepRequired&&("Collection"===constraint.__class__&&(constraint=constraint.constraint),constraint instanceof Constraint))for(var node in constraint.options.deepRequired=deepRequired,constraint.nodes)if(constraint.isRequired(node,group,deepRequired))return!0}return!1},check:function(object,group){var result,failures={};for(var property in this.nodes){var isRequired=this.isRequired(property,group,this.options.deepRequired);if(this.has(property,object)||this.options.strict||isRequired)try{this.has(property,this.options.strict||isRequired?object:undefined)||(new Assert).HaveProperty(property).validate(object),result=this._check(property,object[property],group),(_isArray(result)&&result.length>0||!_isArray(result)&&!_isEmptyObject(result))&&(failures[property]=result)}catch(violation){failures[property]=violation}}return!!_isEmptyObject(failures)||failures},add:function(node,object){if(object instanceof Assert||_isArray(object)&&object[0]instanceof Assert)return this.nodes[node]=object,this;if("object"==typeof object&&!_isArray(object))return this.nodes[node]=object instanceof Constraint?object:new Constraint(object,this.options),this;throw new Error("Should give an Assert, an Asserts array, a Constraint",object)},has:function(node,nodes){return"undefined"!=typeof(nodes=void 0!==nodes?nodes:this.nodes)[node]},get:function(node,placeholder){return this.has(node)?this.nodes[node]:placeholder||null},remove:function(node){var _nodes=[];for(var i in this.nodes)i!==node&&(_nodes[i]=this.nodes[i]);return this.nodes=_nodes,this},_bootstrap:function(data){if(data instanceof Constraint)return this.nodes=data.nodes;for(var node in data)this.add(node,data[node])},_check:function(node,value,group){if(this.nodes[node]instanceof Assert)return this._checkAsserts(value,[this.nodes[node]],group);if(_isArray(this.nodes[node]))return this._checkAsserts(value,this.nodes[node],group);if(this.nodes[node]instanceof Constraint)return this.nodes[node].check(value,group);throw new Error("Invalid node",this.nodes[node])},_checkAsserts:function(value,asserts,group){for(var result,failures=[],i=0;i<asserts.length;i++)void 0!==(result=asserts[i].check(value,group))&&!0!==result&&failures.push(result);return failures}};var Violation=function(assert,value,violation){if(this.__class__="Violation",!(assert instanceof Assert))throw new Error("Should give an assertion implementing the Assert interface");this.assert=assert,this.value=value,void 0!==violation&&(this.violation=violation)};Violation.prototype={show:function(){var show={assert:this.assert.__class__,value:this.value};return this.violation&&(show.violation=this.violation),show},__toString:function(){return"undefined"!=typeof this.violation&&(this.violation='", '+this.getViolation().constraint+" expected was "+this.getViolation().expected),this.assert.__class__+' assert failed for "'+this.value+this.violation||""},getViolation:function(){var constraint,expected;for(constraint in this.violation)expected=this.violation[constraint];return{constraint:constraint,expected:expected}}};var Assert=function(group){this.__class__="Assert",this.__parentClass__=this.__class__,this.groups=[],void 0!==group&&this.addGroup(group)};Assert.extend=function(asserts){function Extended(){Assert.apply(this,arguments)}if("object"!=typeof asserts)throw new Error("Invalid parameter: `asserts` should be an object");if(0===Object.keys(asserts).length)throw new Error("Invalid parameter: `asserts` should have at least one property");for(var key in Extended.prototype=Object.create(Assert.prototype),Extended.prototype.constructor=Extended,asserts){if("function"!=typeof asserts[key])throw new Error("The extension assert must be a function");Extended.prototype[key]=asserts[key]}return Extended},Assert.prototype={construct:Assert,requiresValidation:function(group){return!(group&&!this.hasGroup(group))&&!(!group&&this.hasGroups())},check:function(value,group){if(!this.requiresValidation(group))return!0;try{return this.validate(value,group)}catch(violation){return violation}},hasGroup:function(group){return _isArray(group)?this.hasOneOf(group):"Any"===group||(this.hasGroups()?-1!==this.groups.indexOf(group):"Default"===group)},hasOneOf:function(groups){for(var i=0;i<groups.length;i++)if(this.hasGroup(groups[i]))return!0;return!1},hasGroups:function(){return this.groups.length>0},addGroup:function(group){return _isArray(group)?this.addGroups(group):(this.hasGroup(group)||this.groups.push(group),this)},removeGroup:function(group){for(var _groups=[],i=0;i<this.groups.length;i++)group!==this.groups[i]&&_groups.push(this.groups[i]);return this.groups=_groups,this},addGroups:function(groups){for(var i=0;i<groups.length;i++)this.addGroup(groups[i]);return this},HaveProperty:function(node){return this.__class__="HaveProperty",this.node=node,this.validate=function(object){if("undefined"==typeof object[this.node])throw new Violation(this,object,{value:this.node});return!0},this},Blank:function(){return this.__class__="Blank",this.validate=function(value){if("string"!=typeof value)throw new Violation(this,value,{value:Validator.errorCode.must_be_a_string});if(""!==value.replace(/^\s+/g,"").replace(/\s+$/g,""))throw new Violation(this,value);return!0},this},Callback:function(fn){if(this.__class__="Callback",this.arguments=Array.prototype.slice.call(arguments),1===this.arguments.length?this.arguments=[]:this.arguments.splice(0,1),"function"!=typeof fn)throw new Error("Callback must be instanciated with a function");return this.fn=fn,this.validate=function(value){var result;try{result=this.fn.apply(this,[value].concat(this.arguments))}catch(err){throw new Violation(this,value,{error:err})}if(!0!==result)throw new Violation(this,value,{result:result});return!0},this},Choice:function(list){if(this.__class__="Choice",!_isArray(list)&&"function"!=typeof list)throw new Error("Choice must be instanciated with an array or a function");return this.list=list,this.validate=function(value){for(var list="function"==typeof this.list?this.list():this.list,i=0;i<list.length;i++)if(value===list[i])return!0;throw new Violation(this,value,{choices:list})},this},Collection:function(assertOrConstraint){return this.__class__="Collection",this.constraint=void 0!==assertOrConstraint&&(assertOrConstraint instanceof Assert?assertOrConstraint:new Constraint(assertOrConstraint)),this.validate=function(collection,group){var result,validator=new Validator,count=0,failures={},groups=this.groups.length?this.groups:group;if(!_isArray(collection))throw new Violation(this,collection,{value:Validator.errorCode.must_be_an_array});for(var i=0;i<collection.length;i++)result=this.constraint?validator.validate(collection[i],this.constraint,groups):validator.validate(collection[i],groups),_isEmptyObject(result)||(failures[count]=result),count++;return!!_isEmptyObject(failures)||failures},this},Count:function(count){return this.__class__="Count",this.count=count,this.validate=function(array){if(!_isArray(array))throw new Violation(this,array,{value:Validator.errorCode.must_be_an_array});var count="function"==typeof this.count?this.count(array):this.count;if(isNaN(Number(count)))throw new Error("Count must be a valid interger",count);if(count!==array.length)throw new Violation(this,array,{count:count});return!0},this},Email:function(){return this.__class__="Email",this.validate=function(value){var regExp=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i;if("string"!=typeof value)throw new Violation(this,value,{value:Validator.errorCode.must_be_a_string});if(!regExp.test(value))throw new Violation(this,value);return!0},this},EqualTo:function(reference){if(this.__class__="EqualTo",void 0===reference)throw new Error("EqualTo must be instanciated with a value or a function");return this.reference=reference,this.validate=function(value){var reference="function"==typeof this.reference?this.reference(value):this.reference;if(reference!==value)throw new Violation(this,value,{value:reference});return!0},this},GreaterThan:function(threshold){if(this.__class__="GreaterThan",void 0===threshold)throw new Error("Should give a threshold value");return this.threshold=threshold,this.validate=function(value){if(""===value||isNaN(Number(value)))throw new Violation(this,value,{value:Validator.errorCode.must_be_a_number});if(this.threshold>=value)throw new Violation(this,value,{threshold:this.threshold});return!0},this},GreaterThanOrEqual:function(threshold){if(this.__class__="GreaterThanOrEqual",void 0===threshold)throw new Error("Should give a threshold value");return this.threshold=threshold,this.validate=function(value){if(""===value||isNaN(Number(value)))throw new Violation(this,value,{value:Validator.errorCode.must_be_a_number});if(this.threshold>value)throw new Violation(this,value,{threshold:this.threshold});return!0},this},InstanceOf:function(classRef){if(this.__class__="InstanceOf",void 0===classRef)throw new Error("InstanceOf must be instanciated with a value");return this.classRef=classRef,this.validate=function(value){if(!0!=value instanceof this.classRef)throw new Violation(this,value,{classRef:this.classRef});return!0},this},IsString:function(){return this.__class__="IsString",this.validate=function(value){if(!_isString(value))throw new Violation(this,value,{value:Validator.errorCode.must_be_a_string});return!0},this},Length:function(boundaries){if(this.__class__="Length",!boundaries.min&&!boundaries.max)throw new Error("Length assert must be instanciated with a { min: x, max: y } object");return this.min=parseInt(boundaries.min),this.max=parseInt(boundaries.max),this.validate=function(value){if("string"!=typeof value&&!_isArray(value))throw new Violation(this,value,{value:Validator.errorCode.must_be_a_string_or_array});if("undefined"!=typeof this.min&&this.min===this.max&&value.length!==this.min)throw new Violation(this,value,{min:this.min,max:this.max});if("undefined"!=typeof this.max&&value.length>this.max)throw new Violation(this,value,{max:this.max});if("undefined"!=typeof this.min&&value.length<this.min)throw new Violation(this,value,{min:this.min});return!0},this},LessThan:function(threshold){if(this.__class__="LessThan",void 0===threshold)throw new Error("Should give a threshold value");return this.threshold=threshold,this.validate=function(value){if(""===value||isNaN(Number(value)))throw new Violation(this,value,{value:Validator.errorCode.must_be_a_number});if(this.threshold<=value)throw new Violation(this,value,{threshold:this.threshold});return!0},this},LessThanOrEqual:function(threshold){if(this.__class__="LessThanOrEqual",void 0===threshold)throw new Error("Should give a threshold value");return this.threshold=threshold,this.validate=function(value){if(""===value||isNaN(Number(value)))throw new Violation(this,value,{value:Validator.errorCode.must_be_a_number});if(this.threshold<value)throw new Violation(this,value,{threshold:this.threshold});return!0},this},NotNull:function(){return this.__class__="NotNull",this.validate=function(value){if(null==value)throw new Violation(this,value);return!0},this},NotBlank:function(){return this.__class__="NotBlank",this.validate=function(value){if("string"!=typeof value)throw new Violation(this,value,{value:Validator.errorCode.must_be_a_string});if(""===value.replace(/^\s+/g,"").replace(/\s+$/g,""))throw new Violation(this,value);return!0},this},NotEqualTo:function(reference){if(this.__class__="NotEqualTo",void 0===reference)throw new Error("NotEqualTo must be instanciated with a value or a function");return this.reference=reference,this.validate=function(value){var reference="function"==typeof this.reference?this.reference(value):this.reference;if(reference===value)throw new Violation(this,value,{value:reference});return!0},this},Null:function(){return this.__class__="Null",this.validate=function(value){if(null!==value)throw new Violation(this,value);return!0},this},Range:function(min,max){if(this.__class__="Range",void 0===min||void 0===max)throw new Error("Range assert expects min and max values");return this.min=min,this.max=max,this.validate=function(value){try{return"string"==typeof value&&isNaN(Number(value))||_isArray(value)?(new Assert).Length({min:this.min,max:this.max}).validate(value):(new Assert).GreaterThanOrEqual(this.min).validate(value)&&(new Assert).LessThanOrEqual(this.max).validate(value),!0}catch(violation){throw new Violation(this,value,violation.violation)}return!0},this},Regexp:function(regexp,flag){if(this.__class__="Regexp",void 0===regexp)throw new Error("You must give a regexp");return this.regexp=regexp,this.flag=flag,this.validate=function(value){if("string"!=typeof value)throw new Violation(this,value,{value:Validator.errorCode.must_be_a_string});if(!new RegExp(this.regexp,this.flag).test(value))throw new Violation(this,value,{regexp:this.regexp,flag:this.flag});return!0},this},Required:function(){return this.__class__="Required",this.validate=function(value){if(void 0===value)throw new Violation(this,value);try{"string"==typeof value?(new Assert).NotNull().validate(value)&&(new Assert).NotBlank().validate(value):!0===_isArray(value)&&(new Assert).Length({min:1}).validate(value)}catch(violation){throw new Violation(this,value)}return!0},this},Unique:function(object){return this.__class__="Unique","object"==typeof object&&(this.key=object.key),this.validate=function(array){var value,store=[];if(!_isArray(array))throw new Violation(this,array,{value:Validator.errorCode.must_be_an_array});for(var i=0;i<array.length;i++)if(void 0!==(value="object"==typeof array[i]?array[i][this.key]:array[i])){if(-1!==store.indexOf(value))throw new Violation(this,array,{value:value});store.push(value)}return!0},this}},exports.Assert=Assert,exports.Validator=Validator,exports.Violation=Violation,exports.Constraint=Constraint,Array.prototype.indexOf||(Array.prototype.indexOf=function(searchElement){"use strict";if(null===this)throw new TypeError;var t=Object(this),len=t.length>>>0;if(0===len)return-1;var n=0;if(arguments.length>1&&((n=Number(arguments[1]))!=n?n=0:0!==n&&n!=Infinity&&n!=-Infinity&&(n=(n>0||-1)*Math.floor(Math.abs(n)))),n>=len)return-1;for(var k=n>=0?n:Math.max(len-Math.abs(n),0);k<len;k++)if(k in t&&t[k]===searchElement)return k;return-1});var _isEmptyObject=function(obj){for(var property in obj)return!1;return!0},_isArray=function(obj){return"[object Array]"===Object.prototype.toString.call(obj)},_isString=function(str){return"[object String]"===Object.prototype.toString.call(str)};"function"==typeof define&&define.amd?define(function(){return exports}):"undefined"!=typeof module&&module.exports?module.exports=exports:window["undefined"!=typeof validatorjs_ns?validatorjs_ns:"Validator"]=exports}();