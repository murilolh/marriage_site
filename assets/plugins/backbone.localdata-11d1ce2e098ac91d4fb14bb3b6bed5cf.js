!function(root,factory){"function"==typeof define&&define.amd?define(["underscore","backbone"],function(_,Backbone){return factory(_||root._,Backbone||root.Backbone)}):factory(_,Backbone)}(this,function(_,Backbone){return Backbone.LocalData=function(name){this.name=name},_.extend(Backbone.LocalData.prototype,{get_data:function(){this.store_data=$("script[id='"+this.name+"']");var store=null;return this.store_data.get(0)&&(store=JSON.parse(this.store_data.html()),"true"!=this.store_data.attr("persist")&&this.store_data.remove()),store||[]},hasData:function(){return!!$("script[id='"+this.name+"']").get(0)}}),Backbone.dataRealSync=Backbone.sync,Backbone.LocalData.sync=Backbone.dataSync=function(method,model,options){var resp,errorMessage,store=model.localData||model.collection.localData,syncDfd=$.Deferred&&$.Deferred();try{options.data||model.toJSON();switch(method){case"read":if(!store.hasData())return Backbone.dataRealSync.apply(this,arguments);resp=store.get_data();break;case"create":case"update":case"delete":return Backbone.dataRealSync.apply(this,arguments)}}catch(error){errorMessage=error.code===DOMException.QUOTA_EXCEEDED_ERR&&0===store._storageSize()?"Private browsing is unsupported":error.message}return resp?(model.trigger("sync",model,resp,options),options&&options.success&&("0.9.10"===Backbone.VERSION?options.success(model,resp,options):options.success(resp)),syncDfd&&syncDfd.resolve(resp)):(errorMessage=errorMessage||"Record Not Found",model.trigger("error",model,errorMessage,options),options&&options.error&&("0.9.10"===Backbone.VERSION?options.error(model,errorMessage,options):options.error(errorMessage)),syncDfd&&syncDfd.reject(errorMessage)),options&&options.complete&&options.complete(JSON.stringify(resp)),syncDfd&&syncDfd.promise()},Backbone.getDataSyncMethod=function(model){return model.localData||model.collection&&model.collection.localData?Backbone.dataSync:Backbone.dataRealSync},Backbone.sync=function(method,model,options){return Backbone.getDataSyncMethod(model).apply(this,[method,model,options])},Backbone.LocalData});