function jLoading(element,options){this.options=jQuery.extend({},jLoading.DEFAULTS,options||{}),this.element=element}jQuery.fn.jLoading=function(cfg,value){return"string"!=typeof(cfg=cfg||{})?this.each(function(idx,element){element.loading=new jLoading(jQuery(element),cfg),element.loading.init()}):this.each(function(idx,element){"start"==cfg?element.loading._start():"stop"==cfg?element.loading._stop():"ignore"==cfg?element.loading._ignore(value):"block"==cfg?element.loading.block=value:"abortAllConnections"==cfg&&element.loading._abortAllConnections()}),this},jLoading.prototype._ignore=function(value){value?this.element.attr("ignore","true"):this.element.removeAttr("ignore")},jLoading.prototype._abortAllConnections=function(){if(this.ajaxPool){for(var i=0;i<this.ajaxPool.length;i++){this.ajaxPool[i].abort()}this.ajaxPool=[],this.global_element.hide().find(".global-loading-progress").stop(!0,!0),this.global_element.find(".global-loading-progress").css({width:0})}},jLoading.prototype._start=function(){if("true"!=this.element.attr("ignore")){var self=this;if(self.count<=0&&(self.started_block=self.block,self.count=0),1==self.started_block){if(!$(self.element).is(":visible")){var width=$(self.element).width(),height=$(self.element).height(),window_height=$(window).height(),window_width=$(window).width();$(self.element).css("left",window_width/2-width/2+"px"),$(self.element).css("top",window_height/2-height/2+"px"),$(self.element).show(),self.block_page=$('<div id="block_page"></div>');$(document).height(),$(window).width();self.block_page.css("height",window_height),self.block_page.css("width",window_width),$("body").append(self.block_page)}}else self.global_element.find(".global-loading-progress").css({width:0}),self.global_element.show().find(".global-loading-progress").animate({width:$(window).width()/2},1e3)}},jLoading.prototype._stop=function(){if("true"!=this.element.attr("ignore")){var self=this;self.count<=0&&(self.count=0),1==this.started_block?self.count<=0&&($(self.element).hide(),self.block_page&&(self.block_page.remove(),self.block_page=null)):self.global_element.find(".global-loading-progress").animate({width:$(window).width()},1e3,function(){self.global_element.hide().find(".global-loading-progress").css({width:0})})}},jLoading.prototype.array_search=function(arr,obj,start){for(var i=start||0;i<arr.length;i++)if(arr[i]==obj)return i;return-1},jLoading.prototype.init=function(){var self=this;this.count=0,this.ajaxPool=[],this.global_element=$('<div class="global-loading"><div class="global-loading-progress"></div></div>'),this.global_element.find(".global-loading-progress").css({width:0,height:self.options.global_height}),$(window).on("resize",function(){self.global_element.hide().css({width:$(window).width(),height:self.options.global_height})}).trigger("resize"),$("body").append(this.global_element),this.block=this.options.block,$(document).ajaxStart(function(){self._start()}),$(document).ajaxStop(function(){self._stop()}),$.ajaxSetup({beforeSend:function(jqXHR){self.ajaxPool.push(jqXHR),self.count++},complete:function(jqXHR){var index=-1;try{index=Array.prototype.indexOf?self.ajaxPool.indexOf(jqXHR):self.array_search(self.ajaxPool,jqXHR)}catch(e){}index>-1&&self.ajaxPool.splice(index,1),self.count--}})},jQuery.extend(jLoading,{DEFAULTS:{block:!1,global_height:"3px"}});