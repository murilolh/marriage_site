/*
* Print Element Plugin 2.0
*
* Copyright (c) 2012 Erik Zaadi
*
*  Home Page : http://projects.erikzaadi/jQuery.printElement
*  Issues (bug reporting) : http://github.com/erikzaadi/jQuery.printElement/issues
*  jQuery plugin page : http://plugins.jquery.com/project/printElement 
*  
* Dual licensed under the MIT and GPL licenses:
*   http://www.opensource.org/licenses/mit-license.php
*   http://www.gnu.org/licenses/gpl.html
*   
*/
!function(window){function _printElement(element,opts){var html=_getMarkup(element,opts),popupOrIframe=null,documentToWriteTo=null;if("popup"===opts.printMode.toLowerCase())documentToWriteTo=(popupOrIframe=window.open("about:blank","printElementWindow","width=650,height=440,scrollbars=yes")).document;else{var printElementID="printElement_"+Math.round(99999*Math.random()).toString(),iframe=document.createElement("IFRAME");$(iframe).attr({style:opts.iframeElementOptions.styleToAdd,id:printElementID,className:opts.iframeElementOptions.classNameToAdd,frameBorder:0,scrolling:"no",src:"about:blank"}),document.body.appendChild(iframe),(documentToWriteTo=iframe.contentWindow||iframe.contentDocument).document&&(documentToWriteTo=documentToWriteTo.document),popupOrIframe=(iframe=document.frames?document.frames[printElementID]:document.getElementById(printElementID)).contentWindow||iframe}focus(),documentToWriteTo.open(),documentToWriteTo.write(html),documentToWriteTo.close(),_callPrint(popupOrIframe)}function _callPrint(element){element&&element.printPage?element.printPage():setTimeout(function(){_callPrint(element)},50)}function _getElementHTMLIncludingFormElements(element){var $element=$(element);return $(":checked",$element).each(function(){this.setAttribute("checked","checked")}),$("input[type='text']",$element).each(function(){this.setAttribute("value",$(this).val())}),$("select",$element).each(function(){var $select=$(this);$("option",$select).each(function(){$select.val()===$(this).val()&&this.setAttribute("selected","selected")})}),$("textarea",$element).each(function(){var value=$(this).attr("value");$.browser.mozilla&&this.firstChild?this.firstChild.textContent=value:this.innerHTML=value}),$("<div></div>").append($element.clone()).html()}function _getBaseHref(){var port=window.location.port?":"+window.location.port:"";return window.location.protocol+"//"+window.location.hostname+port+window.location.pathname}function _getMarkup(element,opts){var $element=$(element),elementHtml=_getElementHTMLIncludingFormElements(element),html=[];if(html.push("<html><head><title>"+opts.pageTitle+"</title>"),opts.overrideElementCSS){if(opts.overrideElementCSS.length>0)for(var x=0;x<opts.overrideElementCSS.length;x++){var current=opts.overrideElementCSS[x];"string"==typeof current?html.push('<link type="text/css" rel="stylesheet" href="'+current+'" >'):html.push('<link type="text/css" rel="stylesheet" href="'+current.href+'" media="'+current.media+'" >')}}else $("link",document).filter(function(){return"stylesheet"===$(this).attr("rel").toLowerCase()}).each(function(){html.push('<link type="text/css" rel="stylesheet" href="'+$(this).attr("href")+'" media="'+$(this).attr("media")+'" >')});html.push('<base href="'+_getBaseHref()+'" />'),html.push('</head><body style="'+opts.printBodyOptions.styleToAdd+'" class="'+opts.printBodyOptions.classNameToAdd+'">'),html.push('<div class="'+$element.attr("class")+'">'+elementHtml+"</div>");var i="";return html.push("<scr"+i+'ipt type="text/javascript">function printPage(){focus();print();'+($.browser.opera||opts.leaveOpen||"popup"!==opts.printMode.toLowerCase()?"":"close();")+"}</scr"+i+"ipt>"),html.push("</body></html>"),html.join("")}var document=window.document,$=window.jQuery;$.fn.printElement=function(options){var mainOptions=$.extend({},$.fn.printElement.defaults,options);return"iframe"===mainOptions.printMode&&($.browser.opera||/chrome/.test(navigator.userAgent.toLowerCase()))&&(mainOptions.printMode="popup"),$("[id^='printElement_']").remove(),this.each(function(){var opts=$.meta?$.extend({},mainOptions,$(this).data()):mainOptions;_printElement($(this),opts)})},$.fn.printElement.defaults={printMode:"iframe",pageTitle:"",overrideElementCSS:null,printBodyOptions:{styleToAdd:"padding:10px;margin:10px;",classNameToAdd:""},leaveOpen:!1,iframeElementOptions:{styleToAdd:"border:none;position:absolute;width:0px;height:0px;bottom:0px;left:0px;",classNameToAdd:""}},$.fn.printElement.cssElement={href:"",media:""}}(window);