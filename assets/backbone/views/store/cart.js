var CartView=null;!function($){CartView=BaseBackboneView.extend({events:{"click .goto-store":"back_store","click .goto-store-cart_info":"cart_info"},cart_info:function(){Backbone.history.navigate("/"+this.options.noivos.get("login")+"/store/"+this.options.info.id_loja+"/"+this.options.info.id_loja_sel+"/"+this.options.info.page+"/cart_info",!0)},back_store:function(){Backbone.history.navigate("/"+this.options.noivos.get("login")+"/store/"+this.options.info.id_loja+"/"+this.options.info.id_loja_sel+"/"+this.options.info.page,!0)},initialize:function(){this.constructor.__super__.initialize.call(this);var self=this;this.adopted=!0,this.cart_items=new CartProducts,this.cart_items.reset(this.options.cart.get("products")),this.cart_items.on("remove",this.on_remove,this),this.cart_items.on("change",this.on_change,this),this.views=[];var item=$(".template-cart");item.get(0)?(this.setElement(item),self.options.onload&&self.options.onload.call(self)):(this.adopted=!1,render_template("template_store_cart_id","/templates/backbone/"+this.options.noivos.get("id_noivo")+"/store/"+this.options.noivos.get("template_html_version")+"/cart",{noivos:this.options.noivos.attributes,cart:this.options.cart.attributes,info:this.options.info.attributes},function(ret){self.setElement(ret),self.options.onload&&self.options.onload.call(self)}))},update_value:function(){for(var total=0,i=0;i<this.cart_items.length;i++){var product=this.cart_items.at(i),valor=product.get("product").cotas>1?product.get("product").valor/product.get("product").cotas:product.get("product").valor;total+=valor*=product.get("qtd")}$(".total-value").html(Globalize.format(total,"c"))},on_change:function(){this.update_value()},on_remove:function(){this.update_value(),$("#tiptip_holder").hide(),0===this.cart_items.length&&Backbone.history.navigate("/"+this.options.noivos.get("login")+"/store/"+this.options.info.id_loja+"/"+this.options.info.id_loja_sel+"/"+this.options.info.page,!0)},beforeRender:function(){$("body").addClass("store-page-fix"),$(".breadcrumb").hide()},render:function(){var self=this;return self.cart_items.each(function(product){var item_view=new CartItemView({noivos:self.options.noivos.attributes,model:product,loja_dados:self.options.loja_dados});item_view.render(),self.views[product.get("id_loja_produtos")]=item_view}),$(".tTipT").tipTip({defaultPosition:"top"}),$(".cart-link").hide(),this},after_remove:function(){$("body").removeClass("store-page-fix")}})}(jQuery);