var CartItemView=null;!function($){CartItemView=BaseBackboneView.extend({events:{"click .cart-remove":"remove_item","click .update-prod":"update_item","blur input[name='qtd']":"update_item"},update_item:function(ev){var self=this,qtd=0;try{qtd=parseInt(this.$el.find("input[name='qtd']").val())}catch(e){qtd=0}if(isNaN(qtd)&&(alert(qtd),qtd=1,this.$el.find("input[name='qtd']").val(qtd)),0!==qtd){var quantidade_permitida=this.model.get("product").quantidade>this.model.get("product").cotas?this.model.get("product").quantidade_restantes:this.model.get("product").cotas_restantes;this.options.loja_dados&&0===this.options.loja_dados.get("comprado")&&(quantidade_permitida=this.model.get("product").quantidade>this.model.get("product").cotas?this.model.get("product").quantidade:this.model.get("product").cotas),qtd>quantidade_permitida?Boxy.alert(quantidade_permitida>1?I18n_translate("store.cart.wrong_quantities",{qtd:quantidade_permitida}):I18n_translate("store.cart.wrong_quantity",{qtd:quantidade_permitida}),function(){self.$el.find("input[name='qtd']").val(self.model.get("qtd"))},{title:I18n.t("layout.boxy.error_title"),closeText:I18n.t("layout.boxy.close")}):(window.loading.jLoading("block",!0),this.model.save({qtd:qtd},{wait:!0,success:function(){window.loading.jLoading("block",!1)},error:function(){window.loading.jLoading("block",!1),Boxy.alert(I18n.t("store.cart.error_save"),function(){},{title:I18n.t("layout.boxy.error_title"),closeText:I18n.t("layout.boxy.close")})}}))}else self.remove_item(ev)},remove_item:function(){var self=this;window.loading.jLoading("block",!0),this.model.destroy({wait:!0,success:function(){window.loading.jLoading("block",!1),self.$el.remove()},error:function(){window.loading.jLoading("block",!1),Boxy.alert(I18n.t("store.cart.error_remove"),function(){},{title:I18n.t("layout.boxy.error_title"),closeText:I18n.t("layout.boxy.close")})}})},change_item:function(){var valor=this.model.get("product").cotas>1?this.model.get("product").valor/this.model.get("product").cotas:this.model.get("product").valor;valor*=this.model.get("qtd"),this.$el.find(".product-value").html(Globalize.format(valor,"c"))},initialize:function(){this.constructor.__super__.initialize.call(this),this.adopted=!0,this.model.on("change",this.change_item,this);var item=$("tr[productid='"+this.model.get("product").id_loja_produtos+"']");item.get(0),this.setElement(item)},beforeRender:function(){$("body").addClass("store-page-fix")},render:function(){return this},after_remove:function(){$("body").removeClass("store-page-fix")}})}(jQuery);