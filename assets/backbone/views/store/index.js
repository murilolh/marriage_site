var StoreView=null;!function($){StoreView=BaseBackboneView.extend({events:{"click .price-ascend":"price_ascend","click .price-descend":"price_descend","change #select_categorias":"categoria_change"},initialize:function(){this.constructor.__super__.initialize.call(this);var self=this;this.adopted=!0,this.options.entries.on("change",self.redraw,self);var item=$(".template-store"+("v1"==this.options.noivos.get("template_html_version")?"-"+this.options.entries.get("pagination").pag_atual:""));item.get(0)?(this.setElement(item),self.options.onload&&self.options.onload.call(self)):(this.adopted=!1,render_template("template_pagination_store_id","/templates/backbone/"+this.options.noivos.get("id_noivo")+"/pagination/"+this.options.noivos.get("template_html_version"),{noivos:this.options.noivos.attributes,pages_info:this.options.entries.get("pagination")},function(pages_html){render_template("template_store_id","/templates/backbone/"+self.options.noivos.get("id_noivo")+"/store/"+self.options.noivos.get("template_html_version")+"/index",{noivos:self.options.noivos.attributes,pagina:self.options.pagina.attributes,entries:self.options.entries.attributes,loja_dados:self.options.loja_dados.attributes,categorias:self.options.categorias.toJSON(),info:self.options.info,only_products:!1,cart:self.options.cart.attributes,pages_html:pages_html},function(ret){self.setElement(ret),self.options.onload&&self.options.onload.call(self)})}))},resetPagenation:function(){return"v2"==this.options.noivos.get("template_html_version")?0===this.$el.data("page_loader")&&($("#list-loja-v2").empty(),render_template("template_pagination_store_id","/templates/backbone/"+this.options.noivos.get("id_noivo")+"/pagination/"+this.options.noivos.get("template_html_version"),{noivos:this.options.noivos.attributes,pages_info:this.options.entries.get("pagination")},function(pages_html){$(".infinite-pagination").remove(),$(".infinite-loading").remove(),$("article.produtos").after(pages_html)})):($(".product-list").empty(),render_template("template_pagination_store_id","/templates/backbone/"+this.options.noivos.get("id_noivo")+"/pagination/"+this.options.noivos.get("template_html_version"),{noivos:this.options.noivos.attributes,pages_info:this.options.entries.get("pagination")},function(pages_html){$(".def-paginator").remove(),$(".product-list").after(pages_html)})),!0},getSelector:function(){return"v2"==this.options.noivos.get("template_html_version")?$("#list-loja-v2"):$(".product-list")},clearSelector:function(){var selector=this.getSelector();return selector.removeAttr("class"),"v2"!=this.options.noivos.get("template_html_version")&&selector.addClass("product-list"),selector},redraw:function(finish){var self=this,guid=self.options.info.guid,data=self.options.entries.get("entries");$.when(self.resetPagenation()).done(function(){self.delegateEvents(),$("#sort-store-block").hide();var init_more_production=function(i){var entry;entry=data[i],new ProdutoView({guid:guid,model:entry,noivos:self.options.noivos,pagina:self.options.pagina,produto:entry,loja_dados:self.options.loja_dados.attributes,info:self.options.info,cart:self.options.cart,onload:function(){this.render(),$("."+guid).get(0)||(i=data.length),i+1<data.length?init_more_production(i+1):("function"==typeof finish&&finish.call(null),"function"==typeof self.onRedrawFinish&&(self.onRedrawFinish.call(null),self.onRedrawFinish=null),i+1==data.length&&$("#loading-screen").fadeOut(600))}})};init_more_production(0),$("#loading-screen").fadeOut(600)})},beforeRender:function(){$("body").addClass("store-page-fix")},render:function(){var self=this;if(load_css("//assets1.icasei.com.br/assets/formhelper.css"),load_js("//assets1.icasei.com.br/assets/formhelper.js",function(){$(".sort-select select").chosen()}),$(".breadcrumb").show(),this.options.cart.has("products")&&this.options.cart.get("products").length>0){var label=I18n.t("store.cart_item");this.options.cart.get("products").length>1&&(label=I18n.t("store.cart_items")),$("span.cart-items-label").get(0)&&$("span.cart-items-label").html(label),$("span.cart-items").get(0)&&$("span.cart-items").html(this.options.cart.get("products").length),$(".store-cart-href,.cart-icon").on("click",function(){Backbone.history.navigate("/"+self.options.noivos.get("login")+"/store/"+self.options.info.id_loja+"/"+self.options.info.id_loja_sel+"/"+self.options.info.page+"/cart",!0)}),$(".cart-link").show()}else $(".cart-link").hide(),$(".cart-icon").hide();return self.options.info.guid=Math.floor(1e8*Math.random()+1),self.clearSelector().addClass(""+self.options.info.guid),"v2"==self.options.noivos.get("template_html_version")?(this.$el.data("page_loader",0),this.redraw(function(){self.constructor.__super__.setMouseScroll(!1),self.constructor.__super__.infinite_pagination("article.produtos > div > ul.row:last",function(finish,options){self.$el.data("page_loader")!==options.page&&(self.$el.data("page_loader",options.page),self.options.entries.fetch({cache:!1,data:{id_noivo:parseInt(self.options.noivos.get("id_noivo")),id:parseInt(self.options.pagina.get("recurso").id_tipo_loja),id_loja_categoria:self.options.info.id_loja_categoria,order:self.options.info.order,id_loja:self.options.info.id_loja_sel,id_recurso:self.options.pagina.get("recurso").id_recurso,page:options.page},success:function(){"function"==typeof finish&&finish.call(null)},error:function(e,xhr){backbone_proccess_error(xhr)}}))})})):self.redraw(function(){}),this},after_remove:function(){$("body").removeClass("store-page-fix")},categoria_change:function(){if(this.options.info.id_loja_categoria==parseInt($("#select_categorias").val()))return!1;$("#sort-store-block").show(),this.unbind(),this.undelegateEvents(),this.options.info.page=1,Backbone.history.navigate("/"+this.options.noivos.get("login")+"/store/"+this.options.info.id_loja+"/"+this.options.info.id_loja_sel+"/"+this.options.info.page,!1),6==this.options.info.order?this.price_ascend():this.price_descend()},price_ascend:function(event){if($(".price-ascend").hasClass("active")&&null!==event&&event!==undefined)return!1;$("#sort-store-block").show(),this.unbind(),this.undelegateEvents();try{this.options.info.id_loja_categoria=parseInt($("#select_categorias").val())}catch(e){this.options.info.id_loja_categoria=-2}"v2"==this.options.noivos.get("template_html_version")&&this.$el.data("page_loader",0),this.load_production(6)},price_descend:function(event){if($(".price-descend").hasClass("active")&&null!==event&&event!==undefined)return!1;$("#sort-store-block").show(),this.unbind(),this.undelegateEvents();try{this.options.info.id_loja_categoria=parseInt($("#select_categorias").val())}catch(e){this.options.info.id_loja_categoria=-2}"v2"==this.options.noivos.get("template_html_version")&&this.$el.data("page_loader",0),this.load_production(5)},load_production:function(order){var self=this,produtos=this.options.entries;self.options.info.guid=Math.floor(1e8*Math.random()+1),self.clearSelector().addClass(""+self.options.info.guid),produtos.fetch({cache:!1,data:{id_noivo:self.options.noivos.get("id_noivo"),id:self.options.pagina.get("recurso").id_tipo_loja,order:order,id_loja_categoria:self.options.info.id_loja_categoria,id_loja:self.options.info.id_loja_sel,id_recurso:self.options.pagina.get("recurso").id_recurso,page:self.options.info.page},success:function(){5==order?($(".price-ascend").removeClass("active"),$(".price-descend").addClass("active")):($(".price-descend").removeClass("active"),$(".price-ascend").addClass("active")),self.options.info.order=order},error:function(){}})}})}(jQuery);