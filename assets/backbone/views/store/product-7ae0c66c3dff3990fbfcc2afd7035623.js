var ProdutoView=null;!function($){ProdutoView=BaseBackboneView.extend({events:{"click .add_cart":"add_cart"},redirect:function(model){Backbone.history.navigate("/"+this.options.noivos.get("login")+"/store/"+this.options.info.id_loja+"/"+this.options.info.id_loja_sel+"/"+this.options.info.page+"/cart",!0),model.off("change")},add_cart:function(ev){var self=this;self.clearSelector(),$(ev.currentTarget).removeClass("add_cart");var product_id=$(ev.currentTarget).attr("productid"),cart=new Cart;cart.on("change",self.redirect,self),cart.save({id_noivo:self.options.noivos.get("id_noivo"),id_loja_produtos:product_id,id_loja_sel:self.options.info.id_loja_sel,page:self.options.info.page},{wait:!0,error:function(){msg=I18n.t("store.error_add"),"true"==get_meta("CD")&&(msg="Loja desativada"),Boxy.alert(msg,function(){},{title:I18n.t("layout.boxy.error_title"),closeText:I18n.t("layout.boxy.close")})}})},initialize:function(){this.constructor.__super__.initialize.call(this);var self=this;if(this.adopted=!0,this.model!==undefined){var item=$("li[data-produtoid='"+this.model.id_template_produtos+"']");item.get(0)?(this.setElement(item),self.options.onload&&self.options.onload.call(self)):(this.adopted=!1,render_template("template_store_produto_id","/templates/backbone/"+this.options.noivos.get("id_noivo")+"/store/"+this.options.noivos.get("template_html_version")+"/product",{noivos:this.options.noivos.attributes,produto:this.options.model,pagina:this.options.pagina.attributes,loja_dados:this.options.loja_dados,info:this.options.info,cart:this.options.cart.attributes},function(ret){self.setElement(ret),self.options.onload&&self.options.onload.call(self)},!0))}},getSelector:function(){return"v2"==this.options.noivos.get("template_html_version")?$("#list-loja-v2"):$(".product-list")},clearSelector:function(){var selector=this.getSelector();return selector.removeAttr("class"),"v2"!=this.options.noivos.get("template_html_version")&&selector.addClass("product-list"),selector},appendUL:function(){this.$el;var selector,class_name,tagTitle,name_catg=this.options.produto.nome_categoria,order_catg=-1===this.options.info.id_loja_categoria?-1:this.options.produto.order_categoria;if(!(selector=$("."+this.options.guid)).get(0))return!1;if(selector.find("ul[data-order="+order_catg+"]").get(0))return!0;if("v2"==this.options.noivos.get("template_html_version")?(class_name="row catg-products-list list-loja",tagTitle="<h5>"):(class_name="catg-products-list"+(0===this.options.pagina.loja_foto?" quote-list":""),tagTitle="<h5 class='product-list-title'>"),-1!==order_catg){var order_catg_before=0;selector.find("ul").each(function(){var _this=$(this);_this.data("order")<order_catg&&(order_catg_before=order_catg_before>_this.data("order")?order_catg_before:_this.data("order"))}),0===order_catg_before?$.when(selector.prepend(tagTitle+name_catg+'</h5><ul data-order="'+order_catg+'" class="'+class_name+'">')).done(function(){return!0}):$.when(selector.find("ul[data-order="+order_catg_before+"]").after(tagTitle+name_catg+'</h5><ul data-order="'+order_catg+'" class="'+class_name+'">')).done(function(){return!0})}else $.when(selector.append('<ul data-order="'+order_catg+'" class="'+class_name+'">')).done(function(){return!0})},appendLI:function(){var element=this.$el,order_catg=-1===this.options.info.id_loja_categoria?-1:this.options.produto.order_categoria,order_prod=this.options.produto.order_produto,order_prod_before=0;$("ul[data-order="+order_catg+"]").find("li").each(function(){var _this=$(this);_this.data("order")<order_prod&&(order_prod_before=order_prod_before>_this.data("order")?order_prod_before:_this.data("order"))}),0===order_prod_before?$.when($("ul[data-order="+order_catg+"]").prepend(element)).done(function(){return!0}):$.when($("li[data-order="+order_prod_before+"]","ul[data-order="+order_catg+"]").after(element)).done(function(){return!0})},render:function(){var self=this;$("."+self.options.guid).get(0)&&$.when(self.appendUL()).done(function(){self.appendLI()})}})}(jQuery);