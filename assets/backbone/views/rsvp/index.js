var RsvpView=null;!function($){RsvpView=BaseBackboneView.extend({initialize:function(){this.constructor.__super__.initialize.call(this);var self=this;this.adopted=!0;var item=$(".template-rsvp");if(item.get(0))this.setElement(item),self.options.onload&&self.options.onload.call(self);else{var convidado=null;this.adopted=!1,render_template("template_rsvp_id","/templates/backbone/"+this.options.noivos.get("id_noivo")+"/rsvp/"+this.options.noivos.get("template_html_version")+"/index",{noivos:this.options.noivos.attributes,rsvp_config:this.options.rsvp_config.attributes,pagina:this.options.pagina.attributes,convidado:convidado},function(ret){self.setElement(ret),self.options.onload&&self.options.onload.call(self)})}},change_pessoas:function(){var adultos=$("#rsvp select[name='adultos'] option:selected").val();if(""!=adultos){try{adultos=parseInt(adultos)}catch(ex){adultos=0}1==adultos?$("#mensagem").attr("ignore","true"):$("#mensagem").removeAttr("ignore")}},save_rsvp:function(){var self=this;$("#confirm-button-rsvp").attr("onclick","").html(I18n.t("rsvp.buttons.waiting"));var nome=$("#rsvp input[name='nome']").val(),evento=$("#rsvp input[name='evento']:checked").val(),adultos=$("#rsvp select[name='adultos'] option:selected").val(),criancas=$("#rsvp select[name='criancas'] option:selected").val(),email=$("#rsvp input[name='email']").val(),ddd=$("#rsvp input[name='ddd']").val(),telefone=$("#rsvp input[name='telefone']").val(),mensagem=$("#rsvp textarea[name='mensagem']").val(),id_convidado=0;self.options.convidado&&(id_convidado=self.options.convidado.get("id_convidado"));var template_rsvp=new TemplateRsvp;window.loading.jLoading("block",!0),template_rsvp.save({id_noivo:self.options.noivos.get("id_noivo"),nome:nome,evento:evento,qtd_pessoas:adultos,criancas:criancas,convidado:"noiva",email:email,ddd:ddd,telefone:telefone,acompanhantes:mensagem,id_convidado:id_convidado},{wait:!0,success:function(){window.loading.jLoading("block",!1),self.options.convidado=null;render_template("template_rsvp_id","/templates/backbone/"+self.options.noivos.get("id_noivo")+"/rsvp/"+self.options.noivos.get("template_html_version")+"/index",{noivos:self.options.noivos.attributes,rsvp_config:self.options.rsvp_config.attributes,pagina:self.options.pagina.attributes,convidado:null},function(ret){self.setElement(ret),change_content(ret,function(){self.render(),$(".def-result-message").addClass("success").removeClass("error"),$(".def-result-message").html(I18n.t("rsvp.messages.success.success")),$(".def-result-message").show()},{template:"front",noivos:self.options.noivos})});$("#confirm-button-rsvp").attr("onclick","$('#rsvp').formhelper('submit',this,true);").html(I18n.t("rsvp.buttons.confirm"))},error:function(model,xhr){window.loading.jLoading("block",!1);var response=xhr.responseText,response_obj=JSON.parse(response);for(var i in response_obj.errors){var error=response_obj.errors[i];$("#rsvp").formhelper("flagerror",error.key,error.value)}$(".def-result-message").addClass("error").removeClass("success"),$(".def-result-message").html(I18n.t("formhelper.formhelper_invalid_values")),$(".def-result-message").show(),$("#confirm-button-rsvp").attr("onclick","$('#rsvp').formhelper('submit',this,true);").html(I18n.t("rsvp.buttons.confirm"))}})},render:function(){var self=this;return load_css("//assets1.icasei.com.br/assets/formhelper.css"),load_js("//assets1.icasei.com.br/assets/formhelper.js",function(){$("#rsvp").formhelper({defaultField:"nome",autoRender:!1,messages:form_helper_messages,onChangeCompleted:function(field){"adultos"==$(field).attr("id")&&self.change_pessoas()},onSubmitError:function(){$(".def-result-message").addClass("error").removeClass("success"),$(".def-result-message").html(I18n.t("formhelper.formhelper_invalid_values")),$(".def-result-message").show(),$("html,body").animate({scrollTop:0},200)},onSubmit:function(){if(1!=self.options.rsvp_config.get("aberto")||self.options.convidado)self.save_rsvp();else{var nome=$("#nome").val(),template_rsvp_convidado=new TemplateRsvpConvidado;window.loading.jLoading("block",!0),template_rsvp_convidado.fetch({data:{id_noivo:self.options.noivos.get("id_noivo"),nome:nome},success:function(){if(window.loading.jLoading("block",!1),template_rsvp_convidado.get("error"))$(".def-result-message").addClass("error").removeClass("success"),$(".def-result-message").html(I18n.t("rsvp.messages.error.not_found")),$(".def-result-message").show(),$("html,body").animate({scrollTop:0},200);else if($(".def-result-message").hide(),self.options.convidado=template_rsvp_convidado,self.options.convidado){var item=new EJS({url:"/templates/backbone/"+self.options.noivos.get("id_noivo")+"/rsvp/"+self.options.noivos.get("template_html_version")+"/index"}).render({noivos:self.options.noivos.attributes,rsvp_config:self.options.rsvp_config.attributes,pagina:self.options.pagina.attributes,convidado:self.options.convidado.attributes});self.setElement(item),change_content(item,function(){self.render()},{template:"front",noivos:self.options.noivos})}},error:function(){window.loading.jLoading("block",!1),$(".def-result-message").addClass("error").removeClass("success"),$(".def-result-message").html(I18n.t("rsvp.messages.error.error")),$(".def-result-message").show(),$("html,body").animate({scrollTop:0},200)}})}return!1}}),$("#rsvp").formhelper("init"),self.change_pessoas()}),this}})}(jQuery);